<template name="popupWindows_sendTransactionConfirmation">
    <div class="popup-windows tx-info">
        <form action="#">
            {{#with $.Session.get "data"}}
                {{#if $and data (TemplateVar.get "toIsContract")}}
                    <h1>{{i18n "mist.popupWindows.sendTransactionConfirmation.title.contractExecution"}}</h1>
                {{else}}
                    {{#if to}}
                        <h1>{{i18n "mist.popupWindows.sendTransactionConfirmation.title.sendTransaction"}}</h1>
                    {{else}}
                        <h1>{{i18n "mist.popupWindows.sendTransactionConfirmation.title.createContract"}}</h1>
                    {{/if}}
                {{/if}}
            

                <div class="transaction-parties">
                    <div>
                        {{#if TemplateVar.get "fromIsContract"}}
                            <i class="overlap-icon icon-doc"></i>
                        {{else}}
                            <i class="overlap-icon icon-key"></i>
                        {{/if}}
                        {{> dapp_identicon identity=from class="dapp-large"}}
                        <br>
                        <span class="simptip-position-bottom simptip-movable" data-tooltip="{{from}}">{{shortenAddress from}}</span>
                    </div>
                    <div class="amount">
                        {{{totalAmount}}} <span class="unit">ETHER</span>

                        {{#if TemplateVar.get "executionFunction" }}
                            <span class="function-signature">
                                {{#if TemplateVar.get "hasSignature"}}
                                    <span class="function-signature-text has-signature">
                                        {{TemplateVar.get "executionFunction"}}
                                    </span>
                                {{else}}
                                    <span class="function-signature-text">
                                        {{TemplateVar.get "executionFunction"}}
                                    </span>
                                    <a class="lookup-function-signature simptip-position-bottom simptip-movable" data-tooltip="Lookup function signature on 4byte.directory (3rd-party service)">
                                        <i class="icon-magnifier"></i>
                                    </a>
                                {{/if}}
                            </span>
                        {{/if}}
                    </div>
                    <div>
                        {{#if to}}
                            {{#if TemplateVar.get "toIsContract"}}
                                <i class="overlap-icon icon-doc"></i>
                            {{else}}
                                <i class="overlap-icon icon-key"></i>
                            {{/if}}
                            {{> dapp_identicon identity=to class="dapp-large"}}
                            <br>
                            <span class="simptip-position-bottom simptip-movable" data-tooltip="{{to}}">{{shortenAddress to}}</span>
                        {{else}}
                            <i class="circle-icon icon-doc"></i>
                            <br>
                            <span>{{i18n "mist.popupWindows.sendTransactionConfirmation.createContract"}}</span>
                        {{/if}}
                    </div>
                </div>

                {{#if $and data (TemplateVar.get "toIsContract")}}
                    <p class="info">{{{i18n "mist.popupWindows.sendTransactionConfirmation.contractExecutionInfo"}}}</p>
                {{/if}}

                {{#unless to}}
                    <p class="info">{{{i18n "mist.popupWindows.sendTransactionConfirmation.contractCreationInfo"}}}</p>
                {{/unless}}

                <table class="dapp-small">
                    <tbody>
                        <tr>
                            <td>
                                {{i18n "mist.popupWindows.sendTransactionConfirmation.estimatedFee"}} 
                            </td>
                            <td>
                                {{#if $eq (TemplateVar.get "estimatedGas") "invalid"}}
                                    <span class="red"><i class="icon-shield"></i> {{i18n "mist.popupWindows.sendTransactionConfirmation.estimatedGasError"}}</span>
                                {{else}}
                                    {{estimatedFee}} ({{dapp_formatNumber (TemplateVar.get "estimatedGas") "0,0"}} gas)
                                {{/if}}
                            </td>
                        </tr>
                        <tr>
                            <td>
                                {{i18n "mist.popupWindows.sendTransactionConfirmation.gasLimit"}}
                            </td>
                            <td>
                                {{providedGas}} ether (<span class="provided-gas" contenteditable="true">{{dapp_formatNumber (TemplateVar.get 'initialProvidedGas') '0'}}</span> gas)
                            </td>
                        </tr>
                        <tr>
                            <td>
                                {{i18n "mist.popupWindows.sendTransactionConfirmation.gasPrice"}}
                            </td>
                            <td>{{dapp_formatBalance gasPrice "0,0.0[0000]" "szabo"}} {{i18n "mist.popupWindows.sendTransactionConfirmation.perMillionGas"}}</td>
                        </tr>
                    </tbody>
                </table>

                {{#if data}}
                    {{#if showFormattedParams}}
                        <div class="parameters">
                            <p>{{{i18n "mist.popupWindows.sendTransactionConfirmation.parameters"}}}</p>
                            <a href="#" class="toggle-panel">{{{i18n "mist.popupWindows.sendTransactionConfirmation.showRawBytecode"}}}</a>
                            <ol>
                            {{# each param in params}}
                                {{#if $eq param.type 'bool'}}
                                    <li>
                                        {{param.type}}: 
                                        <strong>
                                        {{#if $eq param.value 'true'}}
                                            YES
                                            <i class="icon-check"></i>
                                        {{else}}
                                            NO
                                            <i class="icon-close"></i>
                                        {{/if}}
                                        </strong>
                                    </li>
                                {{else}}
                                    <li>
                                        {{param.type}}: 
                                        <strong>{{param.value}}</strong>
                                    </li>
                                {{/if}}
                            {{/each}}
                            </ol>
                        </div>
                    {{else}}
                        <div class="data">
                            <p>{{i18n "mist.popupWindows.sendTransactionConfirmation.data"}}</p>
                            
                            {{# if params}}
                                <a href="#" class="toggle-panel">{{{i18n "mist.popupWindows.sendTransactionConfirmation.showDecodedParameters"}}}</a>
                            {{else}}
                                <a class="lookup-function-signature simptip-position-bottom simptip-movable" data-tooltip="Lookup function signature on 4byte.directory (3rd-party service)">
                                    <i class="icon-magnifier"></i>
                                </a>
                            {{/if}}                            

                            <pre>{{{formattedData}}}</pre>
                        </div>
                    {{/if}}
                {{/if}}

            {{/with}}

            {{#if TemplateVar.get "unlocking"}}
                <h2>{{i18n "mist.popupWindows.sendTransactionConfirmation.unlocking"}}</h2>
            {{else}}
                <input type="password" placeholder="{{i18n 'mist.popupWindows.sendTransactionConfirmation.enterPassword'}}">

                <div class="dapp-modal-buttons">
                    <button class="cancel" type="button">{{i18n "buttons.cancel"}}</button>
                    <button class="ok dapp-primary-button" type="submit">{{i18n "mist.popupWindows.sendTransactionConfirmation.buttons.sendTransaction"}}</button>
                </div>
            {{/if}}
        </form>
    </div>
</template>
